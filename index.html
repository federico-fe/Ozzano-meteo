
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Meteo Ozzano (Funziona)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f9f9f9; color: #222; }
    h1 { color: darkred; }
    input, button { padding: 0.5rem; font-size: 1rem; margin: 0.5rem 0; width: 100%; }
    .card { background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); margin-top: 1rem; }
    #log { white-space: pre-wrap; color: darkblue; background: #eef; padding: 0.5rem; border-radius: 5px; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>📍 Meteo Ozzano (API 2.5)</h1>
  <input type="text" id="cityInput" placeholder="Inserisci una città..." />
  <button onclick="loadWeather()">🔄 Carica Meteo</button>

  <div id="output" class="card">⏳ Inserisci una città e premi il pulsante...</div>
  <div id="log"></div>

  <script>
    const apiKey = "9a8552696ac4637ba0f70fa2b4a5c53a";

    async function loadWeather() {
      const city = document.getElementById("cityInput").value.trim();
      const output = document.getElementById("output");
      const log = document.getElementById("log");
      output.textContent = "⏳ Caricamento...";
      log.textContent = "";

      if (!city) {
        output.textContent = "⚠️ Inserisci una città valida.";
        return;
      }

      try {
        log.textContent += "🔎 Cerco coordinate per: " + city + "\n";
        const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${apiKey}`);
        const geoData = await geoRes.json();

        if (!geoData[0]) {
          output.textContent = "❌ Città non trovata.";
          log.textContent += "Nessun risultato per geocoding.\n";
          return;
        }

        const { lat, lon } = geoData[0];
        log.textContent += `✅ Coordinate trovate: lat=${lat}, lon=${lon}\n`;

        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&units=metric&lang=it&appid=${apiKey}`);
        const weatherData = await weatherRes.json();

        if (!weatherData.current) {
          output.textContent = "❌ Dati meteo non disponibili.";
          log.textContent += "Risposta ricevuta ma 'current' mancante.\n";
          return;
        }

        output.innerHTML = `
          <strong>Meteo a ${city}</strong><br>
          ☀️ ${weatherData.current.weather[0].description}<br>
          🌡️ Temp: ${weatherData.current.temp} °C<br>
          💧 Umidità: ${weatherData.current.humidity}%<br>
          💨 Vento: ${weatherData.current.wind_speed} m/s
        `;
        log.textContent += "✅ Dati meteo caricati con successo.\n";

      } catch (err) {
        output.textContent = "❌ Errore nel caricamento dei dati.";
        log.textContent += "Errore: " + err.message;
      }
    }
  </script>
</body>
</html>
